{
  "version": 3,
  "sources": ["../../javascript/controllers/booking_form.js"],
  "sourcesContent": ["document.addEventListener(\"DOMContentLoaded\", () => {\n\n  // ===== ELEMENTS =====\n  const checkIn           = document.getElementById(\"booking_check_in\");\n  const checkOut          = document.getElementById(\"booking_check_out\");\n  const roomSelect        = document.getElementById(\"booking_room_id\");\n  const customerSelect    = document.getElementById(\"booking_customer_id\");\n  const customerPreview   = document.getElementById(\"customer-preview\");\n  const roomStatus        = document.getElementById(\"room-status\");\n\n  const customerSearch    = document.getElementById(\"customer_search\");\n  const resultsBox        = document.getElementById(\"customer-results\");\n  const hiddenCustomerId  = document.getElementById(\"booking_customer_id\");\n  const historyBox        = document.getElementById(\"customer-history\");\n  const roomNameLabel     = document.getElementById(\"selected-room-name\");\n\n  // Page guard\n  if (!customerSearch || !roomSelect) return;\n\n  // ===== ROOMS =====\n  function loadRooms() {\n    if (!checkIn.value || !checkOut.value) return;\n\n    roomSelect.disabled = true;\n    roomSelect.innerHTML = '<option>Loading...</option>';\n\n    fetch(`/bookings/available_rooms?check_in=${checkIn.value}&check_out=${checkOut.value}`)\n      .then(res => res.json())\n      .then(data => {\n        roomSelect.disabled = false;\n        roomSelect.innerHTML = '<option value=\"\">Select room</option>';\n\n        data.forEach(room => {\n          const opt = document.createElement(\"option\");\n          opt.value = room.id;\n          opt.text  = `${room.room_number} - ${room.room_type}`;\n          roomSelect.appendChild(opt);\n        });\n      });\n  }\n\n  // ===== CUSTOMER PREVIEW =====\n  function loadCustomerPreview(id) {\n    fetch(`/customers/${id}.json`)\n      .then(res => res.json())\n      .then(c => {\n        customerPreview.innerHTML = `\n          <p><strong>Name:</strong> ${c.name}</p>\n          <p><strong>Phone:</strong> ${c.phone || \"-\"}</p>\n          <p><strong>Email:</strong> ${c.email || \"-\"}</p>\n        `;\n      });\n  }\n\n  // ===== AUTOCOMPLETE =====\n  customerSearch.addEventListener(\"input\", function () {\n    const q = this.value.trim();\n\n    if (q.length < 2) {\n      resultsBox.innerHTML = \"\";\n      return;\n    }\n\n    fetch(`/customers/search?q=${q}`)\n      .then(res => res.json())\n      .then(data => {\n        resultsBox.innerHTML = \"\";\n\n        data.forEach(c => {\n          const div = document.createElement(\"div\");\n          div.className = \"autocomplete-item\";\n          div.innerHTML = `<strong>${c.name}</strong> (${c.phone})`;\n\n          div.onclick = () => {\n            customerSearch.value = `${c.name} (${c.phone})`;\n            hiddenCustomerId.value = c.id;\n            resultsBox.innerHTML = \"\";\n            loadCustomerPreview(c.id);\n          };\n\n          resultsBox.appendChild(div);\n        });\n      });\n  });\n\n  // ===== ROOM STATUS + NAME + HISTORY =====\n  function handleRoomChange() {\n    if (!roomSelect.value || !checkIn.value || !checkOut.value) return;\n\n    const selectedText = roomSelect.options[roomSelect.selectedIndex].text;\n    roomNameLabel.innerText = selectedText;\n\n    // status\n    fetch(`/bookings/check_room_status?room_id=${roomSelect.value}&check_in=${checkIn.value}&check_out=${checkOut.value}`)\n      .then(res => res.json())\n      .then(data => {\n        if (data.booked) {\n          roomStatus.innerHTML = \"\uD83D\uDD34\";\n          roomStatus.style.color = \"red\";\n        } else {\n          roomStatus.innerHTML = \"\uD83D\uDFE2 \";\n          roomStatus.style.color = \"green\";\n        }\n      });\n\n    // history\n    fetch(`/bookings/room_history?room_id=${roomSelect.value}&check_in=${checkIn.value}&check_out=${checkOut.value}`)\n      .then(res => res.json())\n      .then(data => {\n        if (data.length === 0) {\n          historyBox.innerHTML = \"<p>No previous bookings</p>\";\n          return;\n        }\n\n        historyBox.innerHTML = data.map(b => `\n          <div class=\"history-item\">\n            <strong>${b.customer}</strong><br>\n            ${b.check_in} \u2192 ${b.check_out}<br>\n            Status: <span class=\"status ${b.status}\">${b.status}</span>\n          </div>\n        `).join(\"\");\n      });\n  }\n\n  // ===== EVENTS =====\n  checkIn.addEventListener(\"change\", loadRooms);\n  checkOut.addEventListener(\"change\", loadRooms);\n\n  checkIn.addEventListener(\"change\", handleRoomChange);\n  checkOut.addEventListener(\"change\", handleRoomChange);\n  roomSelect.addEventListener(\"change\", handleRoomChange);\n\n  customerSelect.addEventListener(\"change\", () =>\n    loadCustomerPreview(customerSelect.value)\n  );\n\n});\n"],
  "mappings": "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",
  "names": []
}
